# 数据库的索引背后的工作原理是怎样的？

目前看了sf上一篇概括性的[答案](http://stackoverflow.com/questions/1108/how-does-database-indexing-work)，（关于磁盘块的计算有些奇怪）

总结一下。

## 为什么需要索引？

我们的数据存在磁盘上，磁盘的大小会分块（也依赖于文件系统），因此我们搜索一条数据的时间，就取决于要读多少次磁盘，换句话说就是需要访问多少个block才能找到我们的数据。如果要查一个没有排序，没有索引的field，我们将对全表扫描，耗时将是O(n)，如果排序了，将会是O(log2n)，因为可以二分搜索。那如果那个field的类型不方便排序呢，这时候索引这种数据结构，即使不能sort，也能提高查询速度。

## 索引是怎么工作的？

对一个字段建立索引，其实就是会给原来的表“附加一个表”，里面有这个字段的信息和指向一条record的指针。
```
Field name       Data type      Size on disk
firstName        Char(50)       50 bytes
(record pointer) Special        4 bytes
```
这样如果查询的query里提供了这个字段的信息，那么就能利用先查索引表的方式，**缩小**查询范围。而这个索引表，如果不能排序，那也需要整表扫描，但是由于一个record大小比原来的小很多，存储需要的磁盘block数量远远比之前要少，所以降低了读磁盘的开销。如果能排序，那么就还能加上二分搜索的效果。（总觉的实际算法可能要复杂些）

## 索引的使用

如果那个字段的值在表中的数量太少，比如索引了age，但整个100万条记录的表里age的值只有18-28，那这个索引效率就极低，因为查了索引后，还有10万条记录需要去原表里查。
